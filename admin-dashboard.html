<!DOCTYPE html>
<html lang="id">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Admin Dashboard - Kurikulum Smansaba</title>
    <link rel="stylesheet" href="styles.css">
    <link rel="stylesheet" href="dashboard.css">
    <link rel="stylesheet" href="admin.css">
    <link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0/css/all.min.css" rel="stylesheet">
    <script src="https://cdn.jsdelivr.net/npm/chart.js@3.9.1/dist/chart.min.js"></script>
    
    <!-- XLSX Library - if this fails, CSV will be used automatically -->
    <script src="https://cdnjs.cloudflare.com/ajax/libs/xlsx/0.18.5/xlsx.full.min.js" 
            crossorigin="anonymous" 
            referrerpolicy="no-referrer"></script>
</head>
<body>
    <header class="dashboard-header">
        <div class="header-content">
            <button class="mobile-menu-toggle" onclick="toggleSidebar()">
                <i class="fas fa-bars"></i>
            </button>
            <div class="logo">
                <i class="fas fa-graduation-cap"></i>
                <span>Kurikulum Smansaba - Admin</span>
            </div>
            <div class="user-info">
                <span class="welcome-text">Selamat datang, <span id="adminName">Administrator</span></span>
                <button class="logout-btn desktop-logout" onclick="logout()">
                    <i class="fas fa-sign-out-alt"></i> Logout
                </button>
                <button class="logout-btn mobile-logout" onclick="logout()" title="Logout">
                    <i class="fas fa-sign-out-alt"></i>
                </button>
            </div>
        </div>
    </header>

    <div class="dashboard-container">
        <aside class="sidebar">
            <nav class="sidebar-nav">
                <a href="#overview" class="nav-item active" onclick="showSection('overview')">
                    <i class="fas fa-tachometer-alt"></i>
                    <span>Overview</span>
                </a>
                <a href="#attendance-status" class="nav-item" onclick="showSection('attendance-status')">
                    <i class="fas fa-check-circle"></i>
                    <span>Status Kehadiran</span>
                </a>
                <a href="#reports" class="nav-item" onclick="showSection('reports')">
                    <i class="fas fa-clipboard-list"></i>
                    <span>Laporan Kehadiran</span>
                </a>
                <a href="#schedules" class="nav-item" onclick="showSection('schedules')">
                    <i class="fas fa-calendar-week"></i>
                    <span>Jadwal Kelas</span>
                </a>
                <a href="#analytics" class="nav-item" onclick="showSection('analytics')">
                    <i class="fas fa-chart-bar"></i>
                    <span>Analitik</span>
                </a>
                <a href="#files" class="nav-item" onclick="showSection('files')">
                    <i class="fas fa-folder"></i>
                    <span>File Guru</span>
                </a>
                <a href="#deep-analysis" class="nav-item" onclick="showSection('deep-analysis')">
                    <i class="fas fa-chart-line"></i>
                    <span>Analisis Mendalam</span>
                </a>
            </nav>
        </aside>

        <main class="main-content">
            <section id="overview" class="content-section active">
                <div class="section-header">
                    <h2>Dashboard Overview</h2>
                    <p>Monitoring sistem manajemen sekolah</p>
                </div>
                
                <div class="stats-grid">
                    <div class="stat-card">
                        <div class="stat-icon"><i class="fas fa-clipboard-check"></i></div>
                        <div class="stat-info">
                            <h3 id="totalReports">0</h3>
                            <p>Total Laporan</p>
                        </div>
                    </div>
                    <div class="stat-card">
                        <div class="stat-icon"><i class="fas fa-calendar-week"></i></div>
                        <div class="stat-info">
                            <h3 id="weeklyReports">0</h3>
                            <p>Laporan Minggu Ini</p>
                        </div>
                    </div>
                    <div class="stat-card">
                        <div class="stat-icon"><i class="fas fa-calendar-alt"></i></div>
                        <div class="stat-info">
                            <h3 id="monthlyReports">0</h3>
                            <p>Laporan Bulan Ini</p>
                        </div>
                    </div>
                    <div class="stat-card">
                        <div class="stat-icon"><i class="fas fa-users"></i></div>
                        <div class="stat-info">
                            <h3 id="activeClasses">0</h3>
                            <p>Kelas Aktif</p>
                        </div>
                    </div>
                </div>

                <div class="recent-reports">
                    <h3>Laporan Terbaru</h3>
                    <div class="reports-preview" id="recentReportsPreview"></div>
                    <button class="view-all-btn" onclick="showSection('reports')">
                        <i class="fas fa-eye"></i> Lihat Semua Laporan
                    </button>
                </div>
            </section>

            <section id="attendance-status" class="content-section">
                <div class="section-header">
                    <h2>Status Kehadiran Kelas</h2>
                    <p>Monitor kelas mana yang sudah dan belum melaporkan kehadiran hari ini</p>
                </div>

                <div class="attendance-status-controls">
                    <div class="date-selector">
                        <label for="statusDate">Pilih Tanggal:</label>
                        <input type="date" id="statusDate" onchange="loadAttendanceStatus()">
                    </div>
                    <button class="refresh-btn" onclick="loadAttendanceStatus()">
                        <i class="fas fa-sync-alt"></i> Refresh
                    </button>
                </div>

                <div class="status-summary">
                    <div class="summary-card reported">
                        <div class="summary-icon">
                            <i class="fas fa-check-circle"></i>
                        </div>
                        <div class="summary-info">
                            <h3 id="reportedCount">0</h3>
                            <p>Kelas Sudah Lapor</p>
                        </div>
                    </div>
                    <div class="summary-card pending">
                        <div class="summary-icon">
                            <i class="fas fa-clock"></i>
                        </div>
                        <div class="summary-info">
                            <h3 id="pendingCount">0</h3>
                            <p>Kelas Belum Lapor</p>
                        </div>
                    </div>
                    <div class="summary-card total">
                        <div class="summary-icon">
                            <i class="fas fa-users"></i>
                        </div>
                        <div class="summary-info">
                            <h3 id="totalClasses">0</h3>
                            <p>Total Kelas</p>
                        </div>
                    </div>
                </div>

                <div class="attendance-status-table">
                    <div class="table-header">
                        <h3>Detail Status Kehadiran</h3>
                        <div class="table-filters">
                            <select id="statusFilter" onchange="filterAttendanceStatus()">
                                <option value="all">Semua Status</option>
                                <option value="reported">Sudah Lapor</option>
                                <option value="pending">Belum Lapor</option>
                            </select>
                        </div>
                    </div>
                    <div class="table-container">
                        <table id="attendanceStatusTable">
                            <thead>
                                <tr>
                                    <th>Kelas</th>
                                    <th>Status</th>
                                    <th>Waktu Lapor Terakhir</th>
                                    <th>Jumlah Mata Pelajaran</th>
                                    <th>Aksi</th>
                                </tr>
                            </thead>
                            <tbody id="attendanceStatusTableBody">
                                <tr>
                                    <td colspan="5" class="loading">
                                        <i class="fas fa-spinner fa-spin"></i> Memuat data...
                                    </td>
                                </tr>
                            </tbody>
                        </table>
                    </div>
                </div>
            </section>

            <section id="reports" class="content-section">
                <div class="section-header">
                    <h2>Laporan Kehadiran</h2>
                    <p>Kelola dan monitor laporan kehadiran dari perwakilan kelas</p>
                </div>

                <div class="reports-filters">
                    <div class="filter-group">
                        <label for="filterMonth">Bulan</label>
                        <select id="filterMonth" onchange="loadReports()">
                            <option value="">Semua Bulan</option>
                            <option value="01">Januari</option>
                            <option value="02">Februari</option>
                            <option value="03">Maret</option>
                            <option value="04">April</option>
                            <option value="05">Mei</option>
                            <option value="06">Juni</option>
                            <option value="07">Juli</option>
                            <option value="08">Agustus</option>
                            <option value="09">September</option>
                            <option value="10">Oktober</option>
                            <option value="11">November</option>
                            <option value="12">Desember</option>
                        </select>
                    </div>
                    <div class="filter-group">
                        <label for="filterYear">Tahun</label>
                        <select id="filterYear" onchange="loadReports()">
                            <option value="">Semua Tahun</option>
                            <option value="2024">2024</option>
                            <option value="2025">2025</option>
                            <option value="2026">2026</option>
                        </select>
                    </div>
                    <div class="filter-group">
                        <label for="filterClass">Kelas</label>
                        <select id="filterClass" onchange="loadReports()">
                            <option value="">Semua Kelas</option>
                        </select>
                    </div>
                    <div class="filter-group">
                        <label for="filterTeacher">Guru</label>
                        <select id="filterTeacher" onchange="loadReports()">
                            <option value="">Semua Guru</option>
                        </select>
                    </div>
                    <button class="filter-btn" onclick="loadReports()">
                        <i class="fas fa-search"></i> Filter
                    </button>
                    <button class="export-btn" onclick="exportReports()">
                        <i class="fas fa-download"></i> Export
                    </button>
                </div>

                <div class="reports-container">
                    <div class="reports-summary" id="reportsSummary"></div>
                    <div class="reports-list" id="reportsList"></div>
                </div>
            </section>

            <section id="schedules" class="content-section">
                <div class="section-header">
                    <h2>Jadwal Kelas Terdaftar</h2>
                    <p>Lihat dan kelola jadwal pelajaran yang telah didaftarkan oleh setiap kelas</p>
                </div>

                <div class="schedules-filters">
                    <div class="filter-group">
                        <label for="scheduleFilterClass">Pilih Kelas</label>
                        <select id="scheduleFilterClass" onchange="loadClassSchedules()">
                            <option value="">Pilih Kelas</option>
                        </select>
                    </div>
                    <div class="filter-group">
                        <label for="scheduleFilterDay">Hari</label>
                        <select id="scheduleFilterDay" onchange="loadClassSchedules()">
                            <option value="">Semua Hari</option>
                            <option value="Senin">Senin</option>
                            <option value="Selasa">Selasa</option>
                            <option value="Rabu">Rabu</option>
                            <option value="Kamis">Kamis</option>
                            <option value="Jumat">Jumat</option>
                        </select>
                    </div>
                    <button class="filter-btn" onclick="loadClassSchedules()">
                        <i class="fas fa-search"></i> Lihat Jadwal
                    </button>
                    <button class="export-btn" onclick="exportSchedules()">
                        <i class="fas fa-download"></i> Export Jadwal
                    </button>
                </div>

                <div class="schedules-summary" id="schedulesSummary">
                    <div class="summary-card">
                        <div class="summary-icon">
                            <i class="fas fa-calendar-check"></i>
                        </div>
                        <div class="summary-info">
                            <h3 id="totalScheduledClasses">0</h3>
                            <p>Kelas dengan Jadwal</p>
                        </div>
                    </div>
                    <div class="summary-card">
                        <div class="summary-icon">
                            <i class="fas fa-clock"></i>
                        </div>
                        <div class="summary-info">
                            <h3 id="totalScheduledPeriods">0</h3>
                            <p>Total Jam Pelajaran</p>
                        </div>
                    </div>
                    <div class="summary-card">
                        <div class="summary-icon">
                            <i class="fas fa-chalkboard-teacher"></i>
                        </div>
                        <div class="summary-info">
                            <h3 id="totalActiveTeachers">0</h3>
                            <p>Guru Aktif</p>
                        </div>
                    </div>
                </div>

                <div class="schedules-container">
                    <div class="schedule-overview" id="scheduleOverview">
                        <div class="no-selection">
                            <i class="fas fa-calendar-alt"></i>
                            <h3>Pilih Kelas untuk Melihat Jadwal</h3>
                            <p>Gunakan dropdown di atas untuk memilih kelas dan melihat jadwal pelajaran mereka</p>
                        </div>
                    </div>
                    
                    <div class="schedule-details" id="scheduleDetails" style="display: none;">
                        <div class="schedule-header">
                            <h3 id="selectedClassName">Jadwal Kelas</h3>
                            <div class="schedule-actions">
                                <button class="action-btn edit-btn" onclick="editClassSchedule()">
                                    <i class="fas fa-edit"></i> Edit Jadwal
                                </button>
                                <button class="action-btn delete-btn" onclick="deleteClassSchedule()">
                                    <i class="fas fa-trash"></i> Hapus Jadwal
                                </button>
                            </div>
                        </div>
                        
                        <div class="schedule-tabs">
                            <div class="tab-buttons">
                                <button class="tab-btn active" onclick="switchScheduleTab('table')">
                                    <i class="fas fa-table"></i> Tabel
                                </button>
                                <button class="tab-btn" onclick="switchScheduleTab('weekly')">
                                    <i class="fas fa-calendar-week"></i> Mingguan
                                </button>
                            </div>
                        </div>
                        
                        <div class="schedule-content">
                            <div id="scheduleTableView" class="schedule-view active">
                                <div class="table-container">
                                    <table id="scheduleTable" class="schedule-table">
                                        <thead>
                                            <tr>
                                                <th>Hari</th>
                                                <th>Jam</th>
                                                <th>Mata Pelajaran</th>
                                                <th>Guru</th>
                                                <th>Waktu</th>
                                                <th>Aksi</th>
                                            </tr>
                                        </thead>
                                        <tbody id="scheduleTableBody">
                                        </tbody>
                                    </table>
                                </div>
                            </div>
                            
                            <div id="scheduleWeeklyView" class="schedule-view">
                                <div class="weekly-schedule-grid" id="weeklyScheduleGrid">
                                </div>
                            </div>
                        </div>
                    </div>
                </div>

            </section>

            <section id="analytics" class="content-section">
                <div class="section-header">
                    <h2>Analitik Kehadiran</h2>
                    <p>Analisis data kehadiran guru dan tren pembelajaran</p>
                </div>

                <div class="analytics-filters">
                    <div class="filter-group">
                        <label for="analyticsTeacher">Filter Guru</label>
                        <select id="analyticsTeacher"><option value="">Semua Guru</option></select>
                    </div>
                    <div class="filter-group">
                        <label for="analyticsClass">Filter Kelas</label>
                        <select id="analyticsClass"><option value="">Semua Kelas</option></select>
                    </div>
                    <div class="filter-group">
                        <label for="analyticsTimeSlot">Jam Pelajaran</label>
                        <select id="analyticsTimeSlot">
                            <option value="">Semua Jam</option>
                            <option value="1">Jam 1 (06:30-07:15)</option>
                            <option value="2">Jam 2 (07:15-08:00)</option>
                            <option value="3">Jam 3 (08:00-08:45)</option>
                            <option value="4">Jam 4 (08:45-09:30)</option>
                            <option value="5">Jam 5 (09:45-10:30)</option>
                            <option value="6">Jam 6 (10:30-11:15)</option>
                            <option value="7">Jam 7 (11:15-12:00)</option>
                            <option value="8">Jam 8 (12:45-13:30)</option>
                            <option value="9">Jam 9 (13:30-14:15)</option>
                            <option value="10">Jam 10 (14:15-15:00)</option>
                        </select>
                    </div>
                    <div class="filter-group">
                        <label for="analyticsDate">Tanggal Spesifik</label>
                        <input type="date" id="analyticsDate" style="padding: 8px; border-radius: 5px; border: 1px solid #ccc; width: 100%;" title="Pilih tanggal untuk analitik harian">
                        <small style="color: #64748b; font-size: 0.8em;">Kosongkan untuk semua tanggal</small>
                    </div>
                    <div class="filter-group">
                        <label for="analyticsMonth">Bulan</label>
                        <select id="analyticsMonth">
                            <option value="">Semua Bulan</option>
                            <option value="01">Januari</option>
                            <option value="02">Februari</option>
                            <option value="03">Maret</option>
                            <option value="04">April</option>
                            <option value="05">Mei</option>
                            <option value="06">Juni</option>
                            <option value="07">Juli</option>
                            <option value="08">Agustus</option>
                            <option value="09">September</option>
                            <option value="10">Oktober</option>
                            <option value="11">November</option>
                            <option value="12">Desember</option>
                        </select>
                    </div>
                    <div class="filter-group">
                        <label for="analyticsYear">Tahun</label>
                        <select id="analyticsYear">
                            <option value="">Semua Tahun</option>
                            <option value="2024">2024</option>
                            <option value="2025">2025</option>
                            <option value="2026">2026</option>
                        </select>
                    </div>
                    <button class="filter-btn" onclick="loadAnalytics()">
                        <i class="fas fa-chart-bar"></i> Analisis
                    </button>
                    <button class="filter-btn" id="downloadBtn" onclick="downloadExcelAnalytics()" style="background-color: #10b981;">
                        <i class="fas fa-download"></i> <span id="downloadBtnText">Download Excel/CSV</span>
                    </button>
                </div>

                <div class="analytics-summary-cards">
                    <div class="summary-card">
                        <div class="card-label">Total Kehadiran</div>
                        <div class="card-value" id="totalRecords">0</div>
                        <div class="card-percent" id="hadirPercent">0%</div>
                    </div>
                    <div class="summary-card success">
                        <div class="card-label">Hadir</div>
                        <div class="card-value" id="hadirCount">0</div>
                        <div class="card-percent" id="hadirPercentSuccess">0%</div>
                    </div>
                    <div class="summary-card warning">
                        <div class="card-label">Tugas</div>
                        <div class="card-value" id="tugasCount">0</div>
                        <div class="card-percent" id="tugasPercentWarning">0%</div>
                    </div>
                    <div class="summary-card danger">
                        <div class="card-label">Tidak Hadir</div>
                        <div class="card-value" id="tidakCount">0</div>
                        <div class="card-percent" id="tidakPercentDanger">0%</div>
                    </div>
                </div>

                <div class="analytics-grid">
                    <div class="analytics-card full-width">
                        <h3>Ringkasan Kehadiran (Grafik)</h3>
                        <div style="position: relative; height: 300px; margin-bottom: 20px;">
                            <canvas id="attendanceChart"></canvas>
                        </div>
                    </div>
                    <div class="analytics-card full-width">
                        <h3>Tren Kehadiran per Tanggal</h3>
                        <div style="position: relative; height: 300px; margin-bottom: 20px;">
                            <canvas id="trendChart"></canvas>
                        </div>
                    </div>
                    <div class="analytics-card">
                        <h3>Kehadiran per Guru</h3>
                        <div class="teacher-performance" id="teacherPerformance"></div>
                    </div>
                    <div class="analytics-card">
                        <h3>Kehadiran per Kelas</h3>
                        <div class="class-stats" id="classStats"></div>
                    </div>
                </div>
            </section>

            <section id="files" class="content-section">
                <div class="section-header">
                    <h2>File Administrasi Guru</h2>
                    <p>Monitor file yang diupload oleh guru</p>
                </div>
                <div class="files-overview">
                    <div class="file-stats-grid">
                        <div class="file-stat-card"><div class="file-stat-info"><h3 id="totalFiles">0</h3><p>Total File</p></div></div>
                    </div>
                    <div class="files-list" id="teacherFilesList"></div>
                </div>
            </section>

            <section id="deep-analysis" class="content-section">
                <div class="section-header">
                    <h2>Analisis Mendalam</h2>
                </div>
                <div class="deep-analysis-filters">
                    <div class="filter-row">
                        <div class="filter-group"><label>Tanggal Mulai</label><input type="date" id="startDate"></div>
                        <div class="filter-group"><label>Tanggal Akhir</label><input type="date" id="endDate"></div>
                    </div>
                    <div class="filter-actions">
                        <button class="filter-btn" onclick="loadDeepAnalysis()">Analisis</button>
                    </div>
                </div>
                <div id="teacherAnalysisGrid" class="teacher-analysis-grid"></div>
            </section>
        </main>
    </div>

    <script src="admin-dashboard.js"></script>
</body>
</html>